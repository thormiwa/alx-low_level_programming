More functions about nested loops